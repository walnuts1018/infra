apiVersion: v1
items:
    - apiVersion: apps/v1
      kind: Deployment
      metadata:
        labels:
            app: ac-hacking-2024-back
            app.kubernetes.io/name: ac-hacking-2024-back
        name: ac-hacking-2024-back
        namespace: ac-hacking-2024
      spec:
        replicas: 1
        selector:
            matchLabels:
                app: ac-hacking-2024-back
                app.kubernetes.io/name: ac-hacking-2024-back
        template:
            metadata:
                labels:
                    app: ac-hacking-2024-back
                    app.kubernetes.io/name: ac-hacking-2024-back
            spec:
                containers:
                    - env:
                        - name: PSQL_HOST
                          value: postgresql-default.databases.svc.cluster.local
                        - name: PSQL_PORT
                          value: "5432"
                        - name: PSQL_DATABASE
                          value: ac_hacking
                        - name: PSQL_USER
                          value: ac_hacking
                        - name: PSQL_PASSWORD
                          valueFrom:
                            secretKeyRef:
                                key: postgres_password
                                name: ac-hacking-2024-back
                        - name: PSQL_SSLMODE
                          value: disable
                        - name: PROXY_PASSWORD
                          value: sukina-souzai-happyo-doragon
                        - name: FRONT_URL
                          value: http://ac-hacking-2024-front.ac-hacking-2024.svc.cluster.local:3000
                      image: ghcr.io/walnuts1018/2024-ac-hacking:1c4c5593eb14f8656449d2176c177ca20679ef56-11
                      name: ac-hacking-2024-back
                      ports:
                        - containerPort: 8080
                      resources:
                        limits:
                            memory: 100Mi
                        requests:
                            memory: 10Mi
                      securityContext:
                        readOnlyRootFilesystem: true
                nodeSelector:
                    kubernetes.io/arch: amd64
    - apiVersion: v1
      kind: Service
      metadata:
        labels:
            app: ac-hacking-2024-back
            app.kubernetes.io/name: ac-hacking-2024-back
        name: ac-hacking-2024-back
      spec:
        ports:
            - port: 8080
              protocol: TCP
              targetPort: 8080
        selector:
            app: ac-hacking-2024-back
            app.kubernetes.io/name: ac-hacking-2024-back
        type: ClusterIP
    - apiVersion: external-secrets.io/v1beta1
      kind: ExternalSecret
      metadata:
        name: ac-hacking-2024-back
      spec:
        data:
            - remoteRef:
                key: postgres_passwords
                property: ac-hacking
              secretKey: postgres_password
        refreshInterval: 1m
        secretStoreRef:
            kind: ClusterSecretStore
            name: onepassword
        target:
            name: ac-hacking-2024-back
kind: List

---
