apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
    name: ingress-nginx-helm
    namespace: argocd
spec:
    destination:
        namespace: ingress-nginx
        server: https://kubernetes.default.svc
    project: default
    source:
        chart: ingress-nginx
        helm:
            releaseName: ingress-nginx
            values: |
                controller:
                  config:
                    use-forwarded-headers: true
                    enable-opentelemetry: "true"
                    opentelemetry-trust-incoming-span: "true"
                    otlp-collector-host: "default-collector.opentelemetry-collector.svc.cluster.local"
                    otel-service-name: "ingress-nginx"
                  admissionWebhooks:
                    patch:
                      image:
                        digest: "" # https://github.com/containers/image/blob/d372f0e440d35c6041de39023b0b6eb131fba54b/docker/docker_transport.go#L79-L81
                  service:
                    enabled: true
                    loadBalancerIP: "192.168.0.128"
                    loadBalancerSourceRanges: []
                    enableHttp: false
                    enableHttps: true
                    type: LoadBalancer
                  replicaCount: 3
                  affinity:
                    nodeAffinity:
                      preferredDuringSchedulingIgnoredDuringExecution:
                      - weight: 100
                        preference:
                          matchExpressions:
                          - key: kubernetes.io/arch
                            operator: In
                            values:
                            - amd64
                  opentelemetry:
                    enabled: true
                    name: opentelemetry
                  metrics:
                    enabled: true
                    serviceMonitor:
                      enabled: true
        repoURL: https://kubernetes.github.io/ingress-nginx
        targetRevision: 4.11.3
    syncPolicy:
        automated:
            prune: true
            selfHeal: true

---
