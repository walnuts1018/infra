apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
    name: minio-helm
    namespace: argocd
spec:
    destination:
        namespace: minio
        server: https://kubernetes.default.svc
    project: default
    source:
        chart: minio
        helm:
            releaseName: minio
            values: |
                mode: standalone
                replicas: 1
                existingSecret: minio
                persistence:
                  storageClass: longhorn
                  size: 24Gi
                  volumeName: minio
                  accessMode: ReadWriteOnce
                ingress:
                  enabled: true
                  ingressClassName: nginx
                  annotations:
                    nginx.ingress.kubernetes.io/proxy-body-size: 128G
                  hosts:
                  - minio.walnuts.dev
                consoleIngress:
                  enabled: true
                  ingressClassName: nginx
                  hosts:
                  - minio-console.walnuts.dev
                resources:
                  requests:
                    memory: 500Mi
                oidc:
                  enabled: true
                  configUrl: "https://auth.walnuts.dev/.well-known/openid-configuration"
                  clientId: "241002618523026212@walnuts.dev"
                  # Provide existing client secret from the Kubernetes Secret resource, existing secret will have priority over `clientSecret`
                  existingClientSecretName: "minio"
                  existingClientSecretKey: "client-secret"
                  claimName: "minio-policy"
                  scopes: "openid,profile,email"
                  redirectUri: "https://minio-console.walnuts.dev/oauth_callback"
                  displayName: "Walnuts.dev"
                environment:
                  MINIO_IDENTITY_OPENID_REDIRECT_URI: "https://minio-console.walnuts.dev/oauth_callback"
                  MINIO_SERVER_URL: "https://minio.walnuts.dev"
                  MINIO_BROWSER_REDIRECT_URL: "https://minio-console.walnuts.dev"
                metrics:
                  serviceMonitor:
                    enabled: true

                users: []
        repoURL: https://charts.min.io/
        targetRevision: 5.3.0
    syncPolicy:
        automated:
            prune: true
            selfHeal: true

---
