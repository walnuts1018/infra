apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
    name: misskey
spec:
    data:
        - remoteRef:
            key: postgres_passwords
            property: misskey
          secretKey: misskeydbpassword
        - remoteRef:
            key: redis
            property: password
          secretKey: redispassword
    refreshInterval: 1m
    secretStoreRef:
        kind: ClusterSecretStore
        name: onepassword
    target:
        name: misskey
        template:
            data:
                misskeydbpassword: '{{ .misskeydbpassword }}'
                redispassword: '{{ .redispassword }}'
            engineVersion: v2
            templateFrom:
                - configMap:
                    items:
                        - key: default.yml
                          templateAs: Values
                    name: misskey
                  target: Data
            type: Opaque

---
