apiVersion: cs.walnuts.dev/v1alpha2
kind: CodeServerDeployment
metadata:
  labels:
    app.kubernetes.io/name: codebox
  name: codebox-panda-downloader
spec:
  replicas: 10
  template:
    spec:
      storageSize: 3Gi
      storageClassName: local-path
      initCommand: 'cd work && export NVM_DIR="$HOME/.nvm" && [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" && yarn install'
      initPlugins:
        git:
          repourl: "github.com/walnuts1018/panda-downloader"
          branch: "main"
        copyDefaultConfig: {}
        copyHome: {}
      envs:
        - name: LANGUAGE_DEFAULT
          value: "ja"
      image: "ghcr.io/kmc-jp/code-server-images-node:f66bb947f1dbfe0c07c8323ef45ebd32af0a72f4-54" # {"$imagepolicy": "code-server:code-server-node"}
      imagePullSecrets:
        - name: ghcr-login-secret
      domain: "walnuts.dev"
      ingressClassName: "nginx"
      resources:
        limits:
          cpu: "2000m"
          memory: "4Gi"
        requests:
          cpu: "10m"
          memory: "512Mi"
      nodeSelector:
        kubernetes.io/arch: "amd64"
