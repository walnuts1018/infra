apiVersion: v1
data:
  cluster-resource-set.json: '{"apiVersion": "addons.cluster.x-k8s.io/v1beta2", "kind": "ClusterResourceSet", "metadata": {"name": "longhorn-backup-validate-resourceset", "namespace": "longhorn-backup-validate"}, "spec": {"clusterSelector": {"matchLabels": {"cluster.x-k8s.io/cluster-name": "longhorn-backup-validate"}}, "resources": [{"kind": "Secret", "name": "longhorn-backup-validate-manifest-credentials"}], "strategy": "Reconcile"}}'
  cluster.json: '{"apiVersion": "cluster.x-k8s.io/v1beta2", "kind": "Cluster", "metadata": {"labels": {"cluster.x-k8s.io/cluster-name": "longhorn-backup-validate"}, "name": "longhorn-backup-validate", "namespace": "longhorn-backup-validate"}, "spec": {"clusterNetwork": {"pods": {"cidrBlocks": ["10.243.0.0/16"]}, "services": {"cidrBlocks": ["10.95.0.0/16"]}}, "controlPlaneRef": {"apiGroup": "controlplane.cluster.x-k8s.io", "kind": "TalosControlPlane", "name": "longhorn-backup-validate-control-plane"}, "infrastructureRef": {"apiGroup": "infrastructure.cluster.x-k8s.io", "kind": "KubevirtCluster", "name": "longhorn-backup-validate"}}}'
  external-secret.json: '{"apiVersion": "external-secrets.io/v1", "kind": "ExternalSecret", "metadata": {"name": "longhorn-backup-validate-manifest-credentials", "namespace": "longhorn-backup-validate"}, "spec": {"data": [{"remoteRef": {"key": "longhorn", "property": "minio_secret_key"}, "secretKey": "minio_biscuit_secret_key"}, {"remoteRef": {"key": "velero", "property": "access_key"}, "secretKey": "velero_accessKey"}, {"remoteRef": {"key": "velero", "property": "secret_key"}, "secretKey": "velero_secretKey"}], "refreshInterval": "1m", "secretStoreRef": {"kind": "ClusterSecretStore", "name": "onepassword"}, "target": {"name": "longhorn-backup-validate-manifest-credentials", "template": {"data": {"longhorn-secret.yaml": "apiVersion: v1\nkind: Secret\nmetadata:\n  name: longhorn-backupstore-credential\n  namespace: longhorn-system\ndata:\n  AWS_ACCESS_KEY_ID: {{ \"abaQ84KgJMyEtxZzW3RW\" | b64enc }}\n  AWS_ENDPOINTS: {{ \"https://minio-biscuit.local.walnuts.dev/\" | b64enc }}\n  AWS_SECRET_ACCESS_KEY: {{ .minio_biscuit_secret_key | b64enc }}\ntype: Opaque\n", "namespaces.yaml": "apiVersion: v1\nkind: Namespace\nmetadata:\n  name: longhorn-system\n  labels:\n    pod-security.kubernetes.io/enforce: privileged\n    pod-security.kubernetes.io/enforce-version: latest\n    pod-security.kubernetes.io/audit: privileged\n    pod-security.kubernetes.io/audit-version: latest\n    pod-security.kubernetes.io/warn: privileged\n    pod-security.kubernetes.io/warn-version: latest\n---\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: velero\n  labels:\n    pod-security.kubernetes.io/enforce: privileged\n    pod-security.kubernetes.io/enforce-version: latest\n    pod-security.kubernetes.io/audit: privileged\n    pod-security.kubernetes.io/audit-version: latest\n    pod-security.kubernetes.io/warn: privileged\n    pod-security.kubernetes.io/warn-version: latest\n", "velero-secret.yaml": "apiVersion: v1\nkind: Secret\nmetadata:\n  name: velero-credential\n  namespace: velero\ndata:\n  credentials: {{ printf \"[default]\\naws_access_key_id = %s\\naws_secret_access_key = %s\\n\" .velero_accessKey .velero_secretKey | b64enc }}\ntype: Opaque\n"}, "engineVersion": "v2", "type": "addons.cluster.x-k8s.io/resource-set"}}}}'
  helm-chart-proxy-longhorn.json: '{"apiVersion": "addons.cluster.x-k8s.io/v1alpha1", "kind": "HelmChartProxy", "metadata": {"name": "longhorn", "namespace": "longhorn-backup-validate"}, "spec": {"chartName": "longhorn", "clusterSelector": {"matchLabels": {"cluster.x-k8s.io/cluster-name": "longhorn-backup-validate"}}, "namespace": "longhorn-system", "options": {"atomic": true, "install": {"includeCRDs": true}, "timeout": "5m", "wait": true, "waitForJobs": true}, "releaseName": "longhorn", "repoURL": "https://charts.longhorn.io", "valuesTemplate": "defaultSettings:\n  defaultReplicaCount: ''1''\n  defaultDataPath: \"/var/lib/longhorn/\"\ncsi:\n  attacherReplicaCount: 1\n  provisionerReplicaCount: 1\n  resizerReplicaCount: 1\n  snapshotterReplicaCount: 1\nservice:\n  ui:\n    type: ClusterIP\npersistence:\n  defaultClassReplicaCount: 1\n  reclaimPolicy: Retain\nlonghornUI:\n  replicas: 1\nlonghornConversionWebhook:\n  replicas: 1\nlonghornAdmissionWebhook:\n  replicas: 1\nlonghornRecoveryBackend:\n  replicas: 1\ndefaultBackupStore:\n  backupTarget: \"s3://longhorn-backup@ap-northeast-1/\"\n  backupTargetCredentialSecret: longhorn-backupstore-credential\n", "version": "1.10.1"}}'
  helm-chart-proxy-snapshot-controller.json: '{"apiVersion": "addons.cluster.x-k8s.io/v1alpha1", "kind": "HelmChartProxy", "metadata": {"name": "snapshot-controller", "namespace": "longhorn-backup-validate"}, "spec": {"chartName": "snapshot-controller", "clusterSelector": {"matchLabels": {"cluster.x-k8s.io/cluster-name": "longhorn-backup-validate"}}, "namespace": "kube-system", "options": {"atomic": true, "timeout": "5m", "wait": true, "waitForJobs": true}, "releaseName": "snapshot-controller", "repoURL": "https://piraeus.io/helm-charts/", "version": "4.2.0"}}'
  helm-chart-proxy-velero.json: '{"apiVersion": "addons.cluster.x-k8s.io/v1alpha1", "kind": "HelmChartProxy", "metadata": {"name": "velero", "namespace": "longhorn-backup-validate"}, "spec": {"chartName": "velero", "clusterSelector": {"matchLabels": {"cluster.x-k8s.io/cluster-name": "longhorn-backup-validate"}}, "namespace": "velero", "options": {"atomic": true, "timeout": "5m", "wait": true, "waitForJobs": true}, "releaseName": "velero", "repoURL": "https://vmware-tanzu.github.io/helm-charts", "valuesTemplate": "kubectl:\n  image:\n    repository: docker.io/bitnamilegacy/kubectl\n    tag: 1.33.4\n\ninitContainers:\n- name: velero-plugin-for-aws\n  image: velero/velero-plugin-for-aws:v1.13.1\n  volumeMounts:\n  - mountPath: /target\n    name: plugins\nconfiguration:\n  features: EnableCSI\n  # logLevel: debug\n  backupStorageLocation:\n  - name: minio-biscuit\n    provider: aws\n    bucket: velero-backup\n    config:\n      s3Url: https://minio-biscuit.local.walnuts.dev/\n      region: ap-northeast-1\n      s3ForcePathStyle: \"true\"\n    credential:\n      name: velero-credential\n      key: credentials\n  volumeSnapshotLocation:\n  - name: minio-biscuit\n    provider: aws\n    config:\n      s3Url: https://minio-biscuit.local.walnuts.dev/\n      region: ap-northeast-1\n      s3ForcePathStyle: \"true\"\n    credential:\n      name: velero-credential\n      key: credentials\n", "version": "11.1.1"}}'
  kubevirt-cluster.json: '{"apiVersion": "infrastructure.cluster.x-k8s.io/v1alpha1", "kind": "KubevirtCluster", "metadata": {"name": "longhorn-backup-validate", "namespace": "longhorn-backup-validate"}, "spec": {"controlPlaneServiceTemplate": {"spec": {"type": "LoadBalancer"}}}}'
  kustomization.yaml: |
    apiVersion: 'kustomize.config.k8s.io/v1beta1'
    kind: Kustomization
    resources:
    - cluster-resource-set.json
    - cluster.json
    - external-secret.json
    - helm-chart-proxy-longhorn.json
    - helm-chart-proxy-snapshot-controller.json
    - helm-chart-proxy-velero.json
    - kubevirt-cluster.json
    - machine-deployment.json
    - machine-health-check.json
    - talos-control-plane.json
  machine-deployment.json: '{"apiVersion": "cluster.x-k8s.io/v1beta2", "kind": "MachineDeployment", "metadata": {"labels": {"cluster.x-k8s.io/cluster-name": "longhorn-backup-validate"}, "name": "longhorn-backup-validate-worker", "namespace": "longhorn-backup-validate"}, "spec": {"clusterName": "longhorn-backup-validate", "replicas": 1, "selector": {"matchLabels": {"cluster.x-k8s.io/cluster-name": "longhorn-backup-validate"}}, "template": {"metadata": {"labels": {"cluster.x-k8s.io/cluster-name": "longhorn-backup-validate", "node-role.kubernetes.io/worker": ""}}, "spec": {"bootstrap": {"configRef": {"apiGroup": "bootstrap.cluster.x-k8s.io", "kind": "TalosConfigTemplate", "name": "longhorn-backup-validate-templateworker"}}, "clusterName": "longhorn-backup-validate", "infrastructureRef": {"apiGroup": "infrastructure.cluster.x-k8s.io", "kind": "KubevirtMachineTemplate", "name": "longhorn-backup-validate-template-worker"}, "version": "v1.34.1"}}}}'
  machine-health-check.json: '{"apiVersion": "cluster.x-k8s.io/v1beta2", "kind": "MachineHealthCheck", "metadata": {"name": "longhorn-backup-validate", "namespace": "longhorn-backup-validate"}, "spec": {"clusterName": "longhorn-backup-validate", "selector": {"matchLabels": {"cluster.x-k8s.io/cluster-name": "longhorn-backup-validate"}}}}'
  talos-control-plane.json: '{"apiVersion": "controlplane.cluster.x-k8s.io/v1alpha3", "kind": "TalosControlPlane", "metadata": {"name": "longhorn-backup-validate-control-plane", "namespace": "longhorn-backup-validate"}, "spec": {"controlPlaneConfig": {"controlplane": {"generateType": "controlplane", "talosVersion": "v1.11.5"}}, "infrastructureTemplate": {"apiVersion": "infrastructure.cluster.x-k8s.io/v1alpha1", "kind": "KubevirtMachineTemplate", "name": "longhorn-backup-validate-template-control-plane", "namespace": "longhorn-backup-validate"}, "replicas": 1, "version": "v1.34.1"}}'
kind: ConfigMap
metadata:
  labels:
    app: longhorn-backup-validate
    app.kubernetes.io/name: longhorn-backup-validate
  name: longhorn-backup-validate-manifests-a80230
  namespace: longhorn-backup-validate
