apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: HelmRepository
metadata:
  name: cilium
spec:
  url: https://helm.cilium.io/
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: cilium
spec:
  install:
    disableWait: true
  upgrade:
    disableWait: true
  chart:
    spec:
      chart: cilium
      version: 1.16.1
  values:
    kubeProxyReplacement: true
    k8sServiceHost: 192.168.0.17
    k8sServicePort: 16443
    l2announcements:
      enabled: true
    k8sClientRateLimit:
      qps: 10
      burst: 20
    hubble:
      relay:
        enabled: true
      ui:
        enabled: true
      metrics:
        enableOpenMetrics: true
        enabled: '{dns,drop,tcp,flow,port-distribution,icmp,httpV2:exemplars=true}'
        serviceMonitor:
          enabled: true
